<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:core="http://activemq.apache.org/schema/core"
	xmlns:int="http://www.springframework.org/schema/integration"
	xsi:schemaLocation="http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration-3.0.xsd
		http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd">
	

	<context:component-scan base-package="com.koitoer.spring.integration.cinema"/>
	
	<!-- System entry -->
	<int-stream:stdin-channel-adapter id="consoleIn" channel="systemEntry">
	    <int:poller fixed-delay="1000" max-messages-per-poll="1" />
	</int-stream:stdin-channel-adapter>
	
	<!-- Logging -->
	<int:channel id="systemEntry">
	    <int:interceptors>
	        <int:wire-tap channel="requestLoggingChannel"/>
	    </int:interceptors>
	</int:channel>
 
	<int:logging-channel-adapter id="requestLoggingChannel"
    	expression="'User selection: '.concat(payload)" level="INFO"/>
    
    <!-- Selection filter -->
	<int:filter input-channel="systemEntry" output-channel="validEntriesChannel" ref="entryFilter"
	    discard-channel="invalidEntries"/>
	 
	<!-- Invalid entries (show on console) -->
	<int:chain input-channel="invalidEntries">
	    <int:transformer ref="discardsTransformer"/>
	    <int-stream:stdout-channel-adapter id="consoleOut" append-newline="true" />
	</int:chain>

	<!-- Valid entries (continue processing) -->
	<int:channel id="validEntriesChannel" />
	<int:router input-channel="validEntriesChannel" ref="cinemaRedirector"/>

</beans>
